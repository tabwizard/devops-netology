# Домашняя работа к занятию "5.2. Системы управления виртуализацией"

## Задача 1

Выберете подходящую систему управления виртуализацией для предложенного сценария. Детально опишите ваш выбор.

Сценарии:

- 100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований 
Преимущественно Windows based инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий  
  __ОТВЕТ:__ Т.к. среда хоть и гетерогенная, но преимущественно Windows based, то будем использовать Hyper-V который умеет и Windows и Linux, и программный балансировщик нагрузки Virtual Machine Manager и репликацию встроенными средствами и автоматизированный бэкап с помощью встроенного Windows Server Backup.
- Требуется наиболее производительное бесплатное opensource решение для виртуализации небольшой (20 серверов) инфраструктуры Linux и Windows виртуальных машин  
  __ОТВЕТ:__ Из бесплатных opensource решений наиболее производительным является KVM, вот его вместе с Proxmox и будем использовать.
- Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows инфраструктуры  
  __ОТВЕТ:__ Hyper-V интегрирован в Windows server и не требует отдельной лицензии, так же он максимально совместим с Windows поэтому и с производительностью ВМ на Windows всё будет хорошо
- Необходимо рабочее окружение для тестирование программного продукта на нескольких дистрибутивах Linux  
  __ОТВЕТ:__ Тут возможны варианты. Наверное, лучшим будет на хост машине с Linux запускать Docker-контейнеры с тестируемым ПП на разных базовых контейнерах Linux. Хотя, можно поднять несколько отдельных ВМ в VirtualBox или WMVare Workstation, или QUEMU на той же хост машине Linux и работать с ними. И можно на голое железо накатить WMVare ESXi, или KVM с Proxmox, и поднять ВМ там.

## Задача 2

Опишите сценарий миграции с VMware vSphere на Hyper-V для Linux и Windows виртуальных машин. Детально опишите необходимые шаги для использования всех преимуществ Hyper-V для Windows.  

__ОТВЕТ:__ Миграция ВМ с VMware vSphere на Hyper-V возможна несколькими способами:  

1. **Microsoft System Center Virtual Machine Manager (SCVMM).** SCVMM позволяет подключить серверы управления VMware vCenter и из единой консоли видеть все
   узлы виртуализации и все виртуальные машины, с возможностью создания, управления
   и конвертации машин. При миграции выключает ВМ, копирует в библиотеку, конвертирует VMDK-диски в VHD, создает ВМ Hyper-V.  
   Плюсы:  

- Любая ОС внутри ВМ  
- Любая ФС внутри ВМ  
- Не использует VSS, работает с "тяжелыми" ВМ  
   Минусы:  
- Длительный период недоступности ВМ
- Требуется покупать лицензии для SCVMM на управляемые узлы vSphere  

2. **Microsoft Virtual Machine Converter (MVMC).** MVMC является отдельным продуктом Microsoft для миграции машин с инфраструктуры VMware vSphere (либо физических серверов) на Hyper-V (либо Microsoft Azure). Так же как и SCVMM при миграции копирует выключенную ВМ на хост Hyper-V и конвертирует диск.  
   Плюсы:  

- Бесплатное решение
- Работает с "тяжелыми" ВМ  
   Минусы:  
- Длительный период недоступности ВМ
- Требуется исходная ВМ поддерживающая VSS, с ФС NTFS  

3. **5nine Easy Converter.** 5nine Easy Converter (далее 5nine) – это стороннее решение V2V. Поставляется в виде бесплатной и платной версий, где платная версия имеет возможность автоматизации. Преимуществом в сравнении с VMM/MVMC является поддержка виртуальных машин второго поколения, в которые он может конвертировать
машины VMware vSphere, использующие режим загрузки UEFI. При миграции напрямую с
VSphere требуются права суперпользователя (root) на узлах. Скорость миграции машин и время недоступности для 5nine сравнимо с MVMC при миграции с vCenter. Выключенная машина копируется, затем конвертируется.

4. **Скриптовое решение на базе NFS, VMotion и бесплатных утилит VHDtool и VHDXtool.** В качестве альтернативы коммерческим решениям предлагается бесплатный вариант, позволяющий существенно снизить время простоя виртуальной машины на период миграции, не зависящий от ОС и ФС ВМ.  
Этапы:  

- На Hyper-V устанавливаем роль NFS-сервера
- Там же создаем папку NFS и добавляем права "rw" для VMWare
- В vSphere добавляем NFS-шару в  storage и разрешаем на соответствующем сетевом интерфейсе vMotion
- При помощи Storage vMotion переносим VMDK-диск с работающей ВМ на NFS-шару Hyper-V
- Удаляем из ВМ компоненты интеграции с VMWare и выключаем ВМ
- С помощью VHDtool и VHDXtool конвертируем VMDK-диск сначала в VHD, а затем в VHDX, устанавливаем соответствующее типу диска расширение
- В Hyper-V создаем ВМ с вновь сконвертированным диском, устанавливаем компоненты интеграции и запускаем ВМ

При написании ответа на этот вопрос использовались следующие ресурсы:  

- [Миграция с VMware vSphere на Windows Server 2012 Hyper-V](https://channel9.msdn.com/Blogs/TechDays-Russia/-VMware-vSphere-Windows-Server-2012-Hyper-V-20121224090800)  
- [Методика миграции виртуальных нагрузок с платформы виртуализации VMware vSphere на платформу виртуализации Microsoft Hyper-V](https://cyberleninka.ru/article/n/metodika-migratsii-virtualnyh-nagruzok-s-platformy-virtualizatsii-vmware-vsphere-na-platformu-virtualizatsii-microsoft-hyper-v)

## Задача 3

Опишите возможные проблемы и недостатки гетерогенной среды виртуализации (использования нескольких систем управления виртуализацией одновременно) и что необходимо сделать для минимизации этих рисков и проблем. Если бы у вас был бы выбор, то создавали ли вы бы гетерогенную среду или нет? Мотивируйте ваш ответ примерами.

---

### Как оформить ДЗ?

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

---
