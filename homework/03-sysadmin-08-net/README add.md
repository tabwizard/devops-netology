# Доработка к домашней работе к занятию "3.8. Компьютерные сети, лекция 3"

3. В лекции мы использовали только 1 VIP адрес для балансировки. У такого подхода несколько отрицательных моментов, один из которых – невозможность активного использования нескольких хостов (1 адрес может только переехать с master на standby). Подумайте, сколько адресов оптимально использовать, если мы хотим без какой-либо деградации выдерживать потерю 1 из 3 хостов при входящем трафике 1.5 Гбит/с и физических линках хостов в 1 Гбит/с? Предполагается, что мы хотим задействовать 3 балансировщика в активном режиме (то есть не 2 адреса на 3 хоста, один из которых в обычное время простаивает).  

    __ОТВЕТ:__ Есть предположение, что чтобы равномерно распределить трафик в 1.5 Гбит/с по 3 хостам с линками в 1 Гбит/с каждый понадобится задействовать RoundRobin DNS с отдачей на все 3 балансировщика с отдельным `VIP` на каждом. Файлы конфигов для `keepalived` должны выглядеть примерно так [раз](https://github.com/tabwizard/devops-netology/blob/main/homework/03-sysadmin-08-net/3_keepalived_1.conf), [два](https://github.com/tabwizard/devops-netology/blob/main/homework/03-sysadmin-08-net/3_keepalived_2.conf), [три](https://github.com/tabwizard/devops-netology/blob/main/homework/03-sysadmin-08-net/3_keepalived_3.conf).  

>Добрый день,

>По первому и второму заданию вопросов нет, всё хорошо.

>Что касается третьего вопроса.
Верно, что разумно в данном случае Round Robin DNS, но вот с оптимальным количеством VIP адресов, я не соглашусь.
Смотрите, у нас входящий трафик - 1.5 Гбит/с, если использовать всего 3 VIP, то в случае потери одного из балансировшиков остальным двум прийдётсяся разделить между собой три адреса.

>Посчитайте, сколько трафика (теоретически конечно) прийдётся в таком случае.

    __ОТВЕТ:__ Если один из 3-х балансировщиков выйдет из строя, то один из оставшихся 2-х примет на себя его обязанности и подхватит его `VIP`. В результате трафик распределится следующим образом 1 Гбит/с на балансировщик с 2-мя `VIP` и 0.5 Гбит/с на второй. Учитывая, что объем полезного трафика составляет около 96% получается, что 0.04 Гбит/с останутся необработанными. Принимаем решение увеличить количество `VIP` до 4-х, тогда в рабочем режиме на каждый балансировщик будет приходиться по 0.375 Гбит/с и выход из строя одного из них увеличит на каком-либо из оставшихся нагрузку до 0.75 Гбит/с. Так же есть вероятность нормальной работы даже при выходе из строя даже 2-х балансировщиков.
