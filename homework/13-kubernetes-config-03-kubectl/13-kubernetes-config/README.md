# Тестовое приложение для раздела 13. Конфигурация Kubernetes

### Исправления

1. В файле **[frontend/js/config.js](./frontend/js/config.js)** `export const BASE_URL =` теперь указывает не на переменную из `ENV`, а на текущий адрес сайта. В связи с этим:
   - Файлы `frontend/.env` и `frontend/.env.example` удалены за ненужностью.
2. В файле **[frontend/js/index.js](./frontend/js/index.js)** вызов `getData(BASE_URL + URL_DETAIL, true);` заменен на `getData(BASE_URL + URL_LIST + RegExp.$1, true);` чтобы при переходе по ссылкам открывалась детальная информация выбранного элемента, а не захардкоженная в `URL_DETAIL`.
3. В файле **[frontend/demo.conf](./frontend/demo.conf)** добавлен раздел для проксирования обращений к бекенду:

   ```json
    location /api {
        proxy_pass http://backend:9000;
    }
   ```

4. В файле **[docker-compose.yml](./docker-compose.yml)** у контейнера `backend` убран форвард портов, но добавлена зависимость от контейнера `db` `depends_on:   - db` чтобы запускался после базы и не приходилось перезапускать. У контейнера `frontend` добавлена связь с бекендом для нормальной работы проксирования `api` - `links:  - backend`.

### Как запускать

Перед сборкой и запуском нужно подготовить файл .env в директории backend, скопировав переменные из файлов .env.example. Значения переменных могут отличаться для запуска в разных средах.  

```bash
docker-compose up --build
```

При создании манифеста для кластера рекомендую обратить внимание на `depends_on:   - db` у контейнера `backend` в файле **[docker-compose.yml](./docker-compose.yml)** и подумать о необходимости использования `livenessProbe`

### Как работает

Запускаются 3 компонента (фронт, бек, база данных). Бекенд связывается с базой через link в докере, фронтенд связывается с бекендом через link в докере.

Фронтенд запускается на 8000 порту, бекенд - на 9000, база - на 5432.

#### P.S

Надеюсь эти изменения помогут следующим студентам заниматься изучением kubernetes, а не искать причину неработоспособности "кривого" приложения.
