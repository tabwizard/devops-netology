# Домашнее задание к занятию "3.6. Компьютерные сети, лекция 1"

1. Необязательное задание:
можно посмотреть целый фильм в консоли `telnet towel.blinkenlights.nl` :)

1. Узнайте о том, сколько действительно независимых (не пересекающихся) каналов есть в разделяемой среде WiFi при работе на 2.4 ГГц. Стандарты с полосой 5 ГГц более актуальны, но регламенты на 5 ГГц существенно различаются в разных странах, а так же не раз обновлялись. В качестве дополнительного вопроса вне зачета, попробуйте найти актуальный ответ и на этот вопрос.  

    __ОТВЕТ:__ Для России с её 13 каналами справедливо утыерждение о 3-х независимых каналах, 1, 6, 11.

1. Адрес канального уровня – MAC адрес – это 6 байт, первые 3 из которых называются OUI – Organizationally Unique Identifier или уникальный идентификатор организации. Какому производителю принадлежит MAC `38:f9:d3:55:55:79`?  

    __ОТВЕТ:__  
    [![2021-05-04 09-09-46_Vivaldi.png](https://raw.githubusercontent.com/tabwizard/devops-netology/main/img/2021-05-04%2009-09-46_Vivaldi.png)](https://github.com/tabwizard/devops-netology/blob/6802153283ebc9128a5a66bf8af2d132a726d4f1/img/2021-05-04%2009-09-46_Vivaldi.png)

1. Каким будет payload TCP сегмента, если Ethernet MTU задан в 9001 байт, размер заголовков IPv4 – 20 байт, а TCP – 32 байта?  

    __ОТВЕТ:__  Считаем так, `Ethernet MTU = payload TCP + TCP Header + IP Header`  
    Итого, 9001 -20 - 32 = __8949__

1. Может ли во флагах TCP одновременно быть установлены флаги SYN и FIN при штатном режиме работы сети? Почему да или нет?  

    __ОТВЕТ:__  Флаги SYN и FIN одновременно в нормальном режиме сети установлены быть не могут так как SYN отвечает за создание соединения, а FIN за его окончание.

1. `ss -ula sport = :53` на хосте имеет следующий вывод:

    ```bash
    State           Recv-Q          Send-Q                   Local Address:Port                     Peer Address:Port          Process
    UNCONN          0               0                        127.0.0.53%lo:domain                        0.0.0.0:*
    ```

    Почему в `State` присутствует только `UNCONN`, и может ли там присутствовать, например, `TIME-WAIT`?  

    __ОТВЕТ:__  В команде использовался ключ `-u`, то есть отображаются только UDP сокеты. У протокола UDP нет соединения и его состояний, поэтому и статус `UNCONN`, а `TIME-WAIT` поисходит при закрытии TCP соединения для того чтобы убедиться что все пакеты дошли до адресата.

1. Обладая знаниями о том, как штатным образом завершается соединение (FIN от инициатора, FIN-ACK от ответчика, ACK от инициатора), опишите в каких состояниях будет находиться TCP соединение в каждый момент времени на клиенте и на сервере при завершении. Схема переходов состояния соединения вам в этом поможет.  

    __ОТВЕТ:__  Инициатор отправляет FIN, ответчик подтверждает ACK и тоже отправляет FIN, инициатор подтверждает ACK и начинается `TIME-WAIT` (рисунок мой)
    [![03-sysadmin-06-net_Net.png](https://raw.githubusercontent.com/tabwizard/devops-netology/main/img/03-sysadmin-06-net_Net.png)](https://github.com/tabwizard/devops-netology/blob/main/img/03-sysadmin-06-net_Net.png)

1. TCP порт – 16 битное число. Предположим, 2 находящихся в одной сети хоста устанавливают между собой соединения. Каким будет теоретическое максимальное число соединений, ограниченное только лишь параметрами L4, которое параллельно может установить клиент с одного IP адреса к серверу с одним IP адресом? Сколько соединений сможет обслужить сервер от одного клиента? А если клиентов больше одного?  

    __ОТВЕТ:__  Теоретически клиент может установить `2^16 = 65536` (хотя если порт 0 - зарезервирован, то `65535`) соединений на 1 порт сервера, которых тоже `2^16`, соответственно между ними может быть установлено `2^32` соединений, при увеличении количества клиентов общее максимально количество соединений не изменится т.к. был достигнут теоретический максимум соединений, а так как в Linux всё есть файл, то количество соединений будет ограничено количеством файловых дескрипторов.

1. Может ли сложиться ситуация, при которой большое число соединений TCP на хосте находятся в состоянии  `TIME-WAIT`? Если да, то является ли она хорошей или плохой? Подкрепите свой ответ пояснением той или иной оценки.  

    __ОТВЕТ:__  Период `TIME-WAIT` задан

    ```bash
    vagrant@vagrant:~$ cat /proc/sys/net/ipv4/tcp_fin_timeout
    60
    ```

    поэтому при большом количестве быстро создающихся/разрывающихся соединений количество соединений в состоянии `TIME-WAIT` так же будет большим (например некий процесс создает по 100 соединений в секукнду, а еще через секунду их закрывает и открывает новые) Это не плохо и не хорошо, это нормально и это просто повод узнать о программе которая их открывает и потом спать спокойно.

1. Чем особенно плоха фрагментация UDP относительно фрагментации TCP?  

    __ОТВЕТ:__  Фрагментация UDP плоха тем, что UDP в отличии от TCP допускает потерю данных и перемешивание, поэтому при фрагментации UDP существует вероятность получить неполные или искаженные данные.

1. Если бы вы строили систему удаленного сбора логов, то есть систему, в которой несколько хостов отправяют на центральный узел генерируемые приложениями логи (предположим, что логи – текстовая информация), какой протокол транспортного уровня вы выбрали бы и почему? Проверьте ваше предположение самостоятельно, узнав о стандартном протоколе syslog.  

    __ОТВЕТ:__  Для системы удаленного сбора логов я бы использовал UDP т.к. для этих целей считаю допустимой потерю или изменение некоторых данных, так же важным моментом будет просто отправка данных по UDP, а не ожидание TCP соединения с недоступным сервером сбора логов (повесим целевую систему из-за логов). И выбор разработчиками syslog протокола UDP подтверждает мои мысли.

1. Сколько портов TCP находится в состоянии прослушивания на вашей виртуальной машине с Ubuntu, и каким процессам они принадлежат?  

    __ОТВЕТ:__  

    ```bash
    vagrant@vagrant:~$ ss -tlp
    State        Recv-Q       Send-Q               Local Address:Port                 Peer Address:Port       Process
    LISTEN       0            4096                       0.0.0.0:sunrpc                    0.0.0.0:*
    LISTEN       0            4096                 127.0.0.53%lo:domain                    0.0.0.0:*
    LISTEN       0            128                        0.0.0.0:ssh                       0.0.0.0:*
    LISTEN       0            4096                          [::]:sunrpc                       [::]:*
    LISTEN       0            128                           [::]:ssh                          [::]:*
    ```

    Процессов пока никаких нет, это порты в состоянии прослушивания. А вот когда на порт кто-то постучится, то systemd поднимет соответствующую службу.  

1. Какой ключ нужно добавить в `tcpdump`, чтобы он начал выводить не только заголовки, но и содержимое фреймов в текстовом виде? А в текстовом и шестнадцатиричном?  

    __ОТВЕТ:__  tcpdump предоставляет два флага: -X для печати содержимого в шестнадцатеричном формате (HEX) и -A для печати содержимого в ASCII  

1. Попробуйте собрать дамп трафика с помощью `tcpdump` на основном интерфейсе вашей виртуальной машины и посмотреть его через tshark или Wireshark (можно ограничить число пакетов `-c 100`). Встретились ли вам какие-то установленные флаги Internet Protocol (не флаги TCP, а флаги IP)? Узнайте, какие флаги бывают. Как на самом деле называется стандарт Ethernet, фреймы которого попали в ваш дамп? Можно ли где-то в дампе увидеть OUI?  

    __ОТВЕТ:__  

    ```bash
    vagrant@vagrant:~$ sudo tcpdump -D
    1.eth0 [Up, Running]
    2.lo [Up, Running, Loopback]
    3.any (Pseudo-device that captures on all interfaces) [Up, Running]
    4.bluetooth-monitor (Bluetooth Linux Monitor) [none]
    5.nflog (Linux netfilter log (NFLOG) interface) [none]
    6.nfqueue (Linux netfilter queue (NFQUEUE) interface) [none]

    vagrant@vagrant:~$ sudo tcpdump -A -c 100 -i eth0 -w ./tcpdump.log
    ```

    В заголовке IPv4 существует 3 бита флагов. Первый бит должен быть всегда равен нулю, второй бит DF (don’t fragment) определяет возможность фрагментации пакета и третий бит MF (more fragments) показывает, не является ли этот пакет последним в цепочке пакетов.  
    [![2021-05-04_12-33-40_tcpdump.png](https://raw.githubusercontent.com/tabwizard/devops-netology/main/img/2021-05-04_12-33-40_tcpdump.png)](https://github.com/tabwizard/devops-netology/blob/main/img/2021-05-04_12-33-40_tcpdump.png)  
    На самом деле стандарт Ethernet называется [IEEE 802.3](https://ru.wikipedia.org/wiki/Ethernet) вернее так называется группа стандартов.  
    OUI можно увидеть в полях Src, Dst в составе MAC (первые 3 октета) и так же в текстовом виде, на скриншоте `PcsCompu` и `RealtecU`
